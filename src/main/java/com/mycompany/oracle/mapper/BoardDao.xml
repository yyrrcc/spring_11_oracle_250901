<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.oracle.dao.BoardDao">

	<!-- 게시판 글쓰기 -->
	<insert id="boardWriteDao">
		INSERT INTO boardtbl (bnum, btitle, bcontent, bwriter)
		VALUES (BOARD_SEQ.nextval, #{param1}, #{param2}, #{param3})
	</insert>
	
	<!-- 게시판 모든 글 목록 (board:member 1:1 매핑) & 멤버 정보 조인 -->
	<resultMap type="com.mycompany.oracle.dto.BoardDto" id="boardWithMember">
		<id property="bnum" column="bnum"/>
		<result property="btitle" column="btitle"/>
		<result property="bcontent" column="bcontent"/>
		<result property="bwriter" column="bwriter"/>
		<result property="bhit" column="bhit"/>
		<result property="bdate" column="bdate"/>
		<result property="rnum" column="rnum"/>
			<association property="memberDto" javaType="com.mycompany.oracle.dto.MemberDto">
				<id property="memberid" column="memberid"/>
				<result property="membernum" column="membernum"/>
				<result property="memberpw" column="memberpw"/>
				<result property="membername" column="membername"/>
				<result property="memberdate" column="memberdate"/>
			</association>
	</resultMap>
	<select id="boardListDao" resultMap="boardWithMember">
		SELECT b.bnum, b.btitle, b.bcontent, b.bwriter, m.membername, b.bhit, b.bdate
		FROM boardtbl b
		INNER JOIN membertbl m
		ON b.bwriter = m.memberid
		ORDER BY b.bnum DESC
	</select>
	
	<!-- 모든 게시글 가져오기 -->
	<select id="allBoardCountDao" resultType="int">
		SELECT count(*) FROM boardtbl
	</select>
	
	<!-- 게시글 삭제하기 -->
	<delete id="boardDeleteDao">
		DELETE FROM boardtbl WHERE bnum = #{param1}
	</delete>
	
	<!-- 글 내용 확인하기 -->
	<select id="boardViewDao" resultMap="boardWithMember">
		<!-- SELECT * FROM boardtbl WHERE bnum = #{param1} 사용할거면 resultType 사용해야함 -->
		SELECT b.bnum, b.btitle, b.bcontent, b.bwriter, m.membername, b.bhit, b.bdate
		FROM boardtbl b
		INNER JOIN membertbl m
		ON b.bwriter = m.memberid
		WHERE b.bnum = #{param1}
	</select>
	
	<!-- 조회수 올리기 -->
	<update id="updateHitDao" >
		UPDATE boardtbl SET bhit = bhit + 1 WHERE bnum = #{param1}
	</update>
	
	<!-- 글 번호로 글 수정하기 -->
	<update id="boardModifyDao">
		UPDATE boardtbl SET btitle = #{param2}, bcontent = #{param3} WHERE bnum = #{param1}
	</update>
	
	
	
	<!-- 페이징된 글 목록 가져오기. 부등호 사용 주의. &lt; &gt; 또는 <![CDATA[  ]]> 사용 -->
	<select id="pageBoardListDao" resultMap="boardWithMember">
		<![CDATA[
		SELECT *
		FROM (
	        SELECT ROWNUM AS rnum, r.*
	        FROM 
	            (SELECT b.bnum, b.btitle, b.bcontent, b.bwriter, m.membername, b.bhit, b.bdate
	            FROM boardtbl b
	            INNER JOIN membertbl m
	            ON b.bwriter = m.memberid
	            ORDER BY b.bnum DESC) r
	        WHERE ROWNUM <= ${param2})
		WHERE rnum >= ${param1}  
		]]>
	</select>
	
	
</mapper>